System.register(["./index-legacy-D9wwV_LM.js","./sortable.esm-legacy-bb6EEu-C.js","./tree-legacy-kDWgomCj.js","./user-legacy-DPnpAsOH.js","./QueryItem.vue_vue_type_script_setup_true_lang-legacy-PDwzg_qu.js","./DialogForm.vue_vue_type_script_setup_true_lang-legacy-D1NFsLCO.js","./data-legacy-CsS4pjCL.js","./content-legacy-CWzKS2vh.js"],(function(e,l){"use strict";var a,t,d,n,o,u,i,s,r,c,v,m,p,b,g,h,y,f,k,_,V,w,C,$,x,I,P,U,q,D,S,j,E,A,F,N,O,T,B,z,K,G,Q,R,L,H,J,M,W,X,Y,Z,ee,le,ae,te,de;return{setters:[e=>{a=e.d,t=e.p,d=e.r,n=e.v,o=e.b,u=e.e,i=e.f,s=e.w,r=e.i,c=e.h,v=e.j,m=e.u,p=e.a3,b=e.ac,g=e.o,h=e.k,y=e.l,f=e.t,k=e.E,_=e.aC,V=e.c,w=e.aL,C=e.aM,$=e.g,x=e.ak,I=e.ah,P=e.as,U=e.aN,q=e.aO,D=e.ae,S=e.aE,j=e.aK,E=e.aP,A=e.aJ},e=>{F=e.S},e=>{N=e.c,O=e.t,T=e.e,B=e.f},e=>{z=e.z,K=e.A,G=e.B,Q=e.C,R=e.b,L=e.D,H=e.E,J=e.F,M=e.G,W=e.H,X=e.I},e=>{Y=e._,Z=e.a,ee=e.b,le=e.c},e=>{ae=e._},e=>{te=e.b},e=>{de=e.m}],execute:function(){var l=document.createElement("style");l.textContent=".sortable-chosen td{border-top-width:2px;--tw-border-opacity: 1;border-top-color:rgb(243 209 158 / var(--tw-border-opacity))}\n",document.head.appendChild(l);const ne=a({name:"OrgForm",__name:"OrgForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},beanIds:{type:Array,required:!0},parentId:{type:String,required:!0},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){const a=e,{parentId:m,beanId:p,showGlobalData:b,modelValue:g}=t(a),h=l,y=d(),f=d({}),k=d([]),_=async e=>{k.value=N(O(await R({current:!b.value})),e?.id)},V=async e=>{await _(e),h("finished")};return n(g,(()=>{g.value&&_()})),(l,a)=>{const t=o("el-tree-select"),d=o("el-form-item"),n=o("el-input");return u(),i(ae,{values:f.value,"onUpdate:values":a[5]||(a[5]=e=>f.value=e),name:l.$t("menu.user.org"),"query-bean":v(z),"create-bean":v(K),"update-bean":v(G),"delete-bean":v(Q),"bean-id":v(p),"bean-ids":e.beanIds,focus:y.value,"init-values":e=>({parentId:v(m)}),"to-values":e=>({...e}),"disable-delete":e=>e.id<=1||e.id===k.value[0]?.id,perms:"org","model-value":e.modelValue,"onUpdate:modelValue":a[6]||(a[6]=e=>l.$emit("update:modelValue",e)),onFinished:V,onBeanChange:a[7]||(a[7]=()=>_())},{default:s((({isEdit:e})=>[e&&f.value.id===k.value[0]?.id?c("",!0):(u(),i(d,{key:0,prop:"parentId",label:l.$t("org.parent"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:s((()=>[r(t,{modelValue:f.value.parentId,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value.parentId=e),data:k.value,"node-key":"id",props:{label:"name",disabled:"disabled"},"default-expanded-keys":k.value.map((e=>e.id)),"render-after-expand":!1,disabled:e,"check-strictly":"",class:"w-full"},null,8,["modelValue","data","default-expanded-keys","disabled"])])),_:2},1032,["label","rules"])),r(d,{prop:"name",label:l.$t("org.name"),rules:{required:!0,message:()=>l.$t("v.required")}},{default:s((()=>[r(n,{ref_key:"focus",ref:y,modelValue:f.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value.name=e),maxlength:"50"},null,8,["modelValue"])])),_:1},8,["label","rules"]),r(d,{prop:"address",label:l.$t("org.address")},{default:s((()=>[r(n,{modelValue:f.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.address=e),maxlength:"255"},null,8,["modelValue"])])),_:1},8,["label"]),r(d,{prop:"phone",label:l.$t("org.phone")},{default:s((()=>[r(n,{modelValue:f.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>f.value.phone=e),maxlength:"100"},null,8,["modelValue"])])),_:1},8,["label"]),r(d,{prop:"contacts",label:l.$t("org.contacts")},{default:s((()=>[r(n,{modelValue:f.value.contacts,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.contacts=e),maxlength:"100"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["values","name","query-bean","create-bean","update-bean","delete-bean","bean-id","bean-ids","focus","init-values","to-values","disable-delete","model-value"])}}}),oe={class:"border-t"},ue={class:"border-t"},ie={class:"border-t"},se={class:"flex items-center justify-between"},re=a({name:"OrgPermissionForm",__name:"OrgPermissionForm",props:{modelValue:{type:Boolean,required:!0},beanId:{type:String,default:null},showGlobalData:{type:Boolean,required:!0}},emits:{"update:modelValue":null,finished:null},setup(e,{emit:l}){const a=e,c=l,{beanId:_,modelValue:V}=t(a),{t:w}=m(),C=d("articlePermission"),$=d(),x=d({}),I=d({}),P=d(!1),U=d(!1),q=d(!1),D=d(),S=d(!1),j=d(!1),E=d(),A=d(!1),F=d(!1),N=d(),K=te();T(K,p.grantPermissions??[]);const G=d([]),Q=d([]),W=b((()=>x.value.global&&!p.globalPermission||p.rank>x.value.rank));n(V,(async()=>{V.value&&((async()=>{null!=_.value&&(x.value=await z(_.value),I.value={...x.value})})(),(async()=>{if(null!=_.value){const e=await H(_.value);D.value?.setCheckedKeys([]),e.forEach((e=>{D.value?.setChecked(e,!0,!1)}))}})(),(async()=>{if(null!=_.value){const e=await J(_.value);E.value?.setCheckedKeys([]),e.forEach((e=>{E.value?.setChecked(e,!0,!1)}))}})(),(async()=>{if(null!=_.value){const e=await M(_.value,a.showGlobalData);N.value?.setCheckedKeys([]),e.forEach((e=>{N.value?.setChecked(e,!0,!1)}))}})())})),g((()=>{(async()=>{G.value=O(await de())})(),(async()=>{Q.value=O(await R({current:!0}))})()}));const X=(e,l,a,t)=>{a.forEach((a=>{a.children&&(l.getNode(a[t??"key"]).expanded=e,X(e,l,a.children,t))}))},Y=(e,l,a,t)=>{l.setCheckedKeys(e?a.map((e=>e[t??"key"])):[])},Z=()=>{null!=D.value&&(I.value.articlePermissions=[...D.value.getCheckedNodes(),...D.value.getHalfCheckedNodes()].map((e=>e.id)))},ee=()=>{null!=E.value&&(I.value.channelPermissions=[...E.value.getCheckedNodes(),...E.value.getHalfCheckedNodes()].map((e=>e.id)))},le=()=>{null!=N.value&&(I.value.orgPermissions=N.value.getCheckedNodes().map((e=>e.id)))};return(l,a)=>{const t=o("el-checkbox"),d=o("el-tree"),n=o("el-tab-pane"),m=o("el-tabs"),p=o("el-form"),b=o("el-tag"),g=o("el-button"),_=o("el-drawer");return u(),i(_,{title:l.$t("permissionSettings"),"with-header":!1,"model-value":e.modelValue,size:576,"onUpdate:modelValue":a[18]||(a[18]=e=>l.$emit("update:modelValue",e))},{default:s((()=>[r(p,{ref_key:"form",ref:$,model:I.value,disabled:W.value,"label-width":"150px"},{default:s((()=>[r(m,{modelValue:C.value,"onUpdate:modelValue":a[15]||(a[15]=e=>C.value=e)},{default:s((()=>[r(n,{label:l.$t("org.articlePermission"),name:"articlePermission"},{default:s((()=>[h("div",oe,[r(t,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),label:l.$t("expand/collapse"),onChange:a[1]||(a[1]=e=>X(e,D.value,G.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[3]||(a[3]=e=>{Y(e,D.value,v(B)(G.value),"id"),Z()})},null,8,["modelValue","label"])]),r(d,{ref_key:"articlePermissionTree",ref:D,data:G.value,"node-key":"id",props:{label:"name"},class:"border rounded","show-checkbox":"",onCheck:a[4]||(a[4]=()=>Z())},null,8,["data"])])),_:1},8,["label"]),r(n,{label:l.$t("role.channelPermission"),name:"channelPermission"},{default:s((()=>[h("div",ue,[r(t,{modelValue:S.value,"onUpdate:modelValue":a[5]||(a[5]=e=>S.value=e),label:l.$t("expand/collapse"),onChange:a[6]||(a[6]=e=>X(e,E.value,G.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:j.value,"onUpdate:modelValue":a[7]||(a[7]=e=>j.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[8]||(a[8]=e=>{Y(e,E.value,v(B)(G.value),"id"),ee()})},null,8,["modelValue","label"])]),r(d,{ref_key:"channelPermissionTree",ref:E,data:G.value,"node-key":"id",props:{label:"name"},class:"border rounded","check-strictly":"","show-checkbox":"",onCheck:a[9]||(a[9]=()=>ee())},null,8,["data"])])),_:1},8,["label"]),r(n,{label:l.$t("org.orgPermission"),name:"orgPermission"},{default:s((()=>[h("div",ie,[r(t,{modelValue:A.value,"onUpdate:modelValue":a[10]||(a[10]=e=>A.value=e),label:l.$t("expand/collapse"),onChange:a[11]||(a[11]=e=>X(e,N.value,Q.value,"id"))},null,8,["modelValue","label"]),r(t,{modelValue:F.value,"onUpdate:modelValue":a[12]||(a[12]=e=>F.value=e),label:l.$t("checkAll/uncheckAll"),onChange:a[13]||(a[13]=e=>{Y(e,N.value,v(B)(Q.value),"id"),le()})},null,8,["modelValue","label"])]),r(d,{ref_key:"orgPermissionTree",ref:N,data:Q.value,"node-key":"id",props:{label:"name"},class:"border rounded","default-expanded-keys":Q.value.map((e=>e.id)),"show-checkbox":"","check-strictly":"",onCheck:a[14]||(a[14]=()=>le())},null,8,["data","default-expanded-keys"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])),_:1},8,["model","disabled"])])),footer:s((()=>[h("div",se,[h("div",null,[r(b,null,{default:s((()=>[y(f(I.value?.name),1)])),_:1})]),h("div",null,[r(g,{onClick:a[16]||(a[16]=()=>l.$emit("update:modelValue",!1))},{default:s((()=>[y(f(l.$t("cancel")),1)])),_:1}),r(g,{type:"primary",loading:P.value,disabled:W.value,onClick:a[17]||(a[17]=()=>{$.value.validate((async e=>{if(e){P.value=!0;try{Z(),ee(),le(),await L(I.value),c("finished"),c("update:modelValue",!1),k.success(w("success"))}finally{P.value=!1}}}))})},{default:s((()=>[y(f(l.$t("save")),1)])),_:1},8,["loading","disabled"])])])])),_:1},8,["title","model-value"])}}}),ce={class:"flex justify-between mx-2 mt-1"},ve={class:"mb-3"},me={class:"mt-3 app-block"};e("default",a({name:"OrgList",__name:"OrgList",setup(e){const{t:l}=m(),a=d({}),t=d(),N=d(),T=d([]),z=d([]),K=d(!1),G=d(!1),L=d(!1),H=d(),J=b((()=>B(T.value).map((e=>e.id)))),M=d("1"),ae=d(!1),te=d(),de=d(!1),oe=d(!1),ue=d(),ie=d([]),se=d(!1),pe=d(),be=d();n(pe,(e=>{ue.value.filter(e)}));const ge=async()=>{se.value=!0;try{ie.value=O(await R({current:!ae.value})),E((()=>{null!=pe.value&&ue.value.filter(pe.value),ue.value.setCurrentKey(be.value?.id)}))}finally{se.value=!1}},he=async()=>{K.value=!0;try{de.value=void 0!==t.value;const e=Object.values(a.value).filter((e=>void 0!==e&&""!==e)).length>0;T.value=await R({...A(a.value),parentId:be.value?.id,current:!ae.value,isIncludeSelf:!0,isIncludeChildren:e,Q_OrderBy:t.value}),e||de.value?te.value=void 0:(T.value=O(T.value),te.value=T.value.map((e=>e.id))),M.value=T.value[0]?.id}finally{K.value=!1}},ye=()=>{ge(),he()};let fe;g((()=>{ye(),(()=>{const e=document.querySelector("#dataTable .el-table__body-wrapper tbody");fe=F.create(e,{handle:".drag-handle",draggable:".drag-draggable",animation:200,chosenClass:"sortable-chosen",onEnd:async function(e){const{oldIndex:a,newIndex:t}=e;if(a!==t){let e=a,d=t,n=T.value;const o=n[0]?.children;o?.length>0&&(n=o,e-=1,d-=1),await W(n[e].id,n[d].id,e>d?"before":"after"),ge(),n.splice(d,0,n.splice(e,1)[0]),k.success(l("success"))}}})})()})),_((()=>{void 0!==fe&&fe.destroy()}));const ke=({column:e,prop:l,order:a})=>{t.value=l&&a?(e.sortBy??l)+("descending"===a?"_desc":""):void 0,ye()},_e=()=>he(),Ve=()=>{N.value.clearSort(),j(a.value),t.value=void 0,ye()},we=e=>{H.value=void 0,null!=e&&(M.value=e),G.value=!0},Ce=e=>{H.value=e,G.value=!0},$e=async e=>{await Q(e),ye(),k.success(l("success"))},xe=e=>e.id>1,Ie=async(e,l,a)=>{"none"!==a&&(await W(e.data.id,l.data.id,a),he())},Pe=async e=>{oe.value?(be.value!=e.parent&&(be.value=e.parent,await he()),Ce(e.id)):(be.value=e,_e())},Ue=(e,l)=>!e||l.name.includes(e),qe=()=>{ue.value.setCurrentKey(null),be.value=void 0,_e()},De=e=>-1===ie.value.findIndex((l=>l.id===e.data.id)),Se=(e,l)=>-1===ie.value.findIndex((e=>e.id===l.data.id));return(e,t)=>{const d=o("el-input"),n=o("el-button"),m=o("el-switch"),b=o("el-tooltip"),g=o("el-tree"),_=o("el-scrollbar"),j=o("el-aside"),E=o("el-popconfirm"),A=o("el-icon"),F=o("el-checkbox"),O=o("el-table-column"),B=o("el-table"),Q=o("el-main"),R=o("el-container"),W=V("loading");return u(),i(R,null,{default:s((()=>[r(j,{width:"220px",class:"pr-3"},{default:s((()=>[r(_,{class:"p-2 bg-white rounded-sm"},{default:s((()=>[r(d,{modelValue:pe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>pe.value=e),"suffix-icon":v(w),size:"small"},null,8,["modelValue","suffix-icon"]),h("div",ce,[r(n,{type:null==be.value?"primary":void 0,link:"",onClick:qe},{default:s((()=>[y(f(e.$t("org.root")),1)])),_:1},8,["type"]),r(b,{content:e.$t("editMode"),placement:"top"},{default:s((()=>[r(m,{modelValue:oe.value,"onUpdate:modelValue":t[1]||(t[1]=e=>oe.value=e),"active-action-icon":v(C),"inactive-action-icon":v(C)},null,8,["modelValue","active-action-icon","inactive-action-icon"])])),_:1},8,["content"])]),$(r(g,{ref_key:"orgTree",ref:ue,data:ie.value,props:{label:"name"},"default-expanded-keys":te.value,"expand-on-click-node":!1,"node-key":"id","highlight-current":"",draggable:"","allow-drag":De,"allow-drop":Se,"filter-node-method":Ue,onNodeClick:Pe,onNodeDragEnd:Ie},null,8,["data","default-expanded-keys"]),[[W,se.value]])])),_:1})])),_:1}),r(Q,{class:"p-0"},{default:s((()=>[h("div",ve,[r(v(Y),{params:a.value,onSearch:_e,onReset:Ve},{default:s((()=>[r(v(Z),{label:e.$t("org.name"),name:"Q_Contains_name"},null,8,["label"]),r(v(Z),{label:e.$t("org.address"),name:"Q_Contains_address"},null,8,["label"]),r(v(Z),{label:e.$t("org.phone"),name:"Q_Contains_phone"},null,8,["label"]),r(v(Z),{label:e.$t("org.contacts"),name:"Q_Contains_contacts"},null,8,["label"])])),_:1},8,["params"])]),h("div",null,[r(n,{type:"primary",icon:v(x),onClick:t[2]||(t[2]=()=>we())},{default:s((()=>[y(f(e.$t("add")),1)])),_:1},8,["icon"]),r(E,{title:e.$t("confirmDelete"),onConfirm:t[3]||(t[3]=()=>$e(z.value.map((e=>e.id))))},{reference:s((()=>[r(n,{disabled:z.value.length<=0,icon:v(I)},{default:s((()=>[y(f(e.$t("delete")),1)])),_:1},8,["disabled","icon"])])),_:1},8,["title"]),r(n,{disabled:v(P)("org:tidyTree"),icon:v(U),onClick:t[4]||(t[4]=()=>(async()=>{await X(),ye(),k.success(l("success"))})())},{default:s((()=>[y(f(e.$t("tidyTree")),1)])),_:1},8,["disabled","icon"]),r(b,{placement:"top",content:e.$t("tidyTree.tooltip")},{default:s((()=>[r(A,{class:"ml-1 text-base align-text-bottom"},{default:s((()=>[r(v(q))])),_:1})])),_:1},8,["content"]),v(p).globalPermission?(u(),i(F,{key:0,modelValue:ae.value,"onUpdate:modelValue":t[5]||(t[5]=e=>ae.value=e),class:"ml-2 align-middle",label:e.$t("globalData"),border:!0,onChange:t[6]||(t[6]=()=>ye())},null,8,["modelValue","label"])):c("",!0),r(v(ee),{name:"org",class:"ml-2"})]),h("div",me,[$((u(),i(B,{id:"dataTable",ref_key:"table",ref:N,"row-key":"id","default-expand-all":"",data:T.value,"row-class-name":({row:e})=>e.children?.length>0||"0"===e.id||"1"===e.id?void 0:"drag-draggable",onSelectionChange:t[7]||(t[7]=e=>z.value=e),onRowDblclick:t[8]||(t[8]=e=>Ce(e.id)),onSortChange:ke},{default:s((()=>[r(v(le),{name:"org"},{default:s((()=>[r(O,{type:"selection",selectable:xe,width:"45"}),r(O,{property:"name",label:e.$t("org.name"),sortable:"custom","min-width":"120"},null,8,["label"]),r(O,{property:"address",label:e.$t("org.address"),sortable:"custom",display:"none","min-width":"100"},null,8,["label"]),r(O,{property:"phone",label:e.$t("org.phone"),sortable:"custom","min-width":"100"},null,8,["label"]),r(O,{property:"contacts",label:e.$t("org.contacts"),sortable:"custom"},null,8,["label"]),r(O,{property:"id",label:"ID",width:"170",sortable:"custom"}),r(O,{width:"42"},{default:s((({row:e})=>[r(A,{class:D(["text-lg align-middle",de.value||v(P)("org:update")||e.children?.length>0||"0"===e.id||"1"===e.id?["cursor-not-allowed","text-gray-disabled"]:["cursor-move","text-gray-secondary","drag-handle"]])},{default:s((()=>[r(v(S))])),_:2},1032,["class"])])),_:1}),r(O,{label:e.$t("table.action"),width:"230"},{default:s((({row:l})=>[r(n,{type:"primary",disabled:v(P)("org:create"),size:"small",link:"",onClick:()=>we(l.id)},{default:s((()=>[y(f(e.$t("addChild")),1)])),_:2},1032,["disabled","onClick"]),r(n,{type:"primary",disabled:v(P)("org:update"),size:"small",link:"",onClick:()=>Ce(l.id)},{default:s((()=>[y(f(e.$t("edit")),1)])),_:2},1032,["disabled","onClick"]),v(p).epRank>=3||v(p).epDisplay?(u(),i(n,{key:0,title:v(p).epRank<3?e.$t("error.enterprise.short"):void 0,disabled:v(P)("org:updatePermission")||v(p).epRank<3,type:"primary",size:"small",link:"",onClick:()=>{return e=l.id,H.value=e,void(L.value=!0);var e}},{default:s((()=>[y(f(e.$t("permissionSettings")),1)])),_:2},1032,["title","disabled","onClick"])):c("",!0),r(E,{title:e.$t("confirmDelete"),onConfirm:()=>$e([l.id])},{reference:s((()=>[r(n,{type:"primary",disabled:!xe(l)||v(P)("org:delete"),size:"small",link:""},{default:s((()=>[y(f(e.$t("delete")),1)])),_:2},1032,["disabled"])])),_:2},1032,["title","onConfirm"])])),_:1},8,["label"])])),_:1})])),_:1},8,["data","row-class-name"])),[[W,K.value]])]),r(ne,{modelValue:G.value,"onUpdate:modelValue":t[9]||(t[9]=e=>G.value=e),"bean-id":H.value,"bean-ids":J.value,"parent-id":M.value,"show-global-data":ae.value,onFinished:ye},null,8,["modelValue","bean-id","bean-ids","parent-id","show-global-data"]),r(re,{modelValue:L.value,"onUpdate:modelValue":t[10]||(t[10]=e=>L.value=e),"bean-id":H.value,"show-global-data":ae.value,onFinished:ye},null,8,["modelValue","bean-id","show-global-data"])])),_:1})])),_:1})}}}))}}}));
